{% extends "base.html" %}

{% block title %}联系我 - 我的个人网站{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <h1 class="text-center mb-5">联系我</h1>
        <p class="text-center lead mb-5">如果你有合作意向或建议和意见？欢迎随时联系我。</p>
    </div>
</div>

<div class="row">
    <!-- 联系表单 -->
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h4><i class="fas fa-envelope"></i> 发送消息</h4>
            </div>
            <div class="card-body">
                <form id="contact-form" data-ajax-form>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="name" class="form-label">姓名 *</label>
                            <input type="text" class="form-control" id="name" name="name" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="email" class="form-label">邮箱</label>
                            <input type="email" class="form-control" id="email" name="email">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="subject" class="form-label">主题 *</label>
                        <input type="text" class="form-control" id="subject" name="subject" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="message" class="form-label">消息内容 *</label>
                        <textarea class="form-control" id="message" name="message" rows="6" required></textarea>
                    </div>
                    
                    <button type="submit" class="btn-submit btn-lg">
                        <i class="fas fa-paper-plane"></i> 发送消息
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- 联系信息 -->
    <div class="col-lg-4">
        <!-- 联系信息卡片 -->
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-address-card"></i> 联系信息</h5>
            </div>
            <div class="card-body">
                <ul class="list-unstyled">
                    <li class="mb-3">
                        <i class="fas fa-envelope text-primary me-2"></i>
                        <a href="mailto:wdws851421092@gmail.com" class="text-decoration-none">wdws851421092@gmail.com</a>
                    </li>
                    <li class="mb-3">
                        <i class="fas fa-phone text-success me-2"></i>
                        <span>+86 135 3115 8704</span>
                    </li>
                    <li class="mb-3">
                        <i class="fas fa-map-marker-alt text-danger me-2"></i>
                        <span>深圳，中国</span>
                    </li>
                    <li class="mb-3">
                        <i class="fas fa-clock text-warning me-2"></i>
                        <span>周一至周五 9:00-18:00</span>
                    </li>
                </ul>
            </div>
        </div>

        <!-- 社交媒体 -->
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-share-alt"></i> 社交媒体</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="https://github.com/Charleskie" class="btn btn-outline-dark" target="_blank">
                        <i class="fab fa-github"></i> GitHub
                    </a>
                    <a href="" class="btn btn-outline-primary" target="_blank">
                        <i class="fab fa-linkedin"></i> LinkedIn
                    </a>
                    <a href="" class="btn btn-outline-info" target="_blank">
                        <i class="fab fa-twitter"></i> Twitter
                    </a>
                    <a href="" class="btn btn-outline-danger" target="_blank">
                        <i class="fab fa-weibo"></i> 微博
                    </a>
                </div>
            </div>
        </div>

        <!-- 快速回复 -->
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-comments"></i> 常见问题</h5>
            </div>
            <div class="card-body">
                <div class="accordion" id="faqAccordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                如何开始合作项目？
                            </button>
                        </h2>
                        <div id="faq1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                请通过联系表单发送详细的项目需求，我会在24小时内回复您。
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                提供哪些技术服务？
                            </button>
                        </h2>
                        <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                包括Web开发、移动应用开发、API设计、数据库设计、系统架构等。
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                                项目周期大概多久？
                            </button>
                        </h2>
                        <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                根据项目复杂度，通常2-8周不等，具体时间会在项目开始前确定。
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 地图区域 -->
<div class="row mt-5">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-map-marker-alt"></i> 位置信息</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="location-info">
                            <h6><i class="fas fa-building"></i> 办公地址</h6>
                            
                            <!-- 地址选择器 -->
                            <div class="mb-3">
                                <label for="office-select" class="form-label">选择办公地点</label>
                                <select class="form-select" id="office-select" onchange="changeOffice()">
                                    <option value="2">深圳 - 南山高新园</option>
                                    <option value="0">上海 - 张江高科技园区</option>
                                    <option value="1">北京 - 望京SOHO</option>
                                </select>
                            </div>
                            
                            <div id="office-info">
                                <p class="mb-2">
                                    <i class="fas fa-map-marker-alt text-danger"></i>
                                    <span id="office-address">深圳市南山区高新南一道</span>
                                </p>
                                <p class="mb-2">
                                    <i class="fas fa-phone text-primary"></i>
                                    <span id="office-phone">+86 137-0000-0000</span>
                                </p>
                                <p class="mb-2">
                                    <i class="fas fa-envelope text-success"></i>
                                    <span id="office-email">shenzhen@example.com</span>
                                </p>
                                <p class="mb-3">
                                    <i class="fas fa-clock text-warning"></i>
                                    <span id="office-hours">工作时间：周一至周五 9:00-18:00</span>
                                </p>
                            </div>
                            
                            <div class="d-grid gap-2">
                                <button class="btn btn-outline-primary" onclick="getCurrentLocation()">
                                    <i class="fas fa-location-arrow"></i> 获取我的位置
                                </button>
                                <button class="btn btn-outline-success" onclick="openInMaps()">
                                    <i class="fas fa-external-link-alt"></i> 在导航中打开
                                </button>
                            </div>
                            
                            <div id="location-status" class="mt-3" style="display: none;">
                                <div class="alert alert-info">
                                    <i class="fas fa-spinner fa-spin"></i> 正在获取位置...
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="map-container">
                            <div id="map" style="height: 300px; border-radius: 8px; overflow: hidden;">
                                <div class="d-flex align-items-center justify-content-center h-100 bg-light">
                                    <div class="text-center">
                                        <i class="fas fa-map fa-3x text-muted mb-3"></i>
                                        <p class="text-muted">点击上方按钮加载地图</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.location-info h6 {
    color: #495057;
    margin-bottom: 1rem;
}

.location-info p {
    margin-bottom: 0.5rem;
}

.location-info i {
    width: 20px;
    margin-right: 8px;
}

.map-container {
    position: relative;
}

.map-container img {
    transition: transform 0.3s ease;
}

.map-container img:hover {
    transform: scale(1.02);
}

#location-status .alert {
    margin-bottom: 0;
    font-size: 14px;
}

.btn-outline-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,123,255,0.3);
}

.btn-outline-success:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(40,167,69,0.3);
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// 办公地址配置
const OFFICE_LOCATIONS = [
    {
        name: '上海 - 张江高科技园区',
        address: '上海市浦东新区张江高科技园区',
        lat: 31.2304,
        lng: 121.4737,
        phone: '+86 138-0000-0000',
        email: 'contact@example.com',
        workingHours: '工作时间：周一至周五 9:00-18:00'
    },
    {
        name: '北京 - 望京SOHO',
        address: '北京市朝阳区望京SOHO',
        lat: 39.9042,
        lng: 116.4074,
        phone: '+86 139-0000-0000',
        email: 'beijing@example.com',
        workingHours: '工作时间：周一至周五 9:00-18:00'
    },
    {
        name: '深圳 - 南山高新园',
        address: '深圳市南山区高新南一道',
        lat: 22.5405,
        lng: 113.9344,
        phone: '+86 137-0000-0000',
        email: 'shenzhen@example.com',
        workingHours: '工作时间：周一至周五 9:00-18:00'
    }
];

let currentOfficeIndex = 2; // 默认选择深圳南山高新园

let map = null;
let userMarker = null;
let officeMarker = null;

document.addEventListener('DOMContentLoaded', function() {
    const contactForm = document.getElementById('contact-form');
    
    contactForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // 获取表单数据
        const formData = new FormData(contactForm);
        const data = Object.fromEntries(formData);
        
        // 这里可以添加表单验证逻辑
        
        // 模拟发送消息
        alert('消息已发送！我会尽快回复您。');
        contactForm.reset();
    });
});

// 获取用户当前位置
function getCurrentLocation() {
    const statusDiv = document.getElementById('location-status');
    statusDiv.style.display = 'block';
    statusDiv.innerHTML = '<div class="alert alert-info"><i class="fas fa-spinner fa-spin"></i> 正在获取位置...</div>';
    
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            function(position) {
                const userLat = position.coords.latitude;
                const userLng = position.coords.longitude;
                const accuracy = position.coords.accuracy;
                
                // 显示位置信息
                statusDiv.innerHTML = `
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle"></i> 位置获取成功！
                        <br><small>精度: ${Math.round(accuracy)}米</small>
                    </div>
                `;
                
                // 初始化地图并显示位置
                initMap(userLat, userLng);
                
                // 计算距离
                const office = OFFICE_LOCATIONS[currentOfficeIndex];
                const distance = calculateDistance(userLat, userLng, office.lat, office.lng);
                showDistanceInfo(distance, office.name);
                
            },
            function(error) {
                let errorMessage = '无法获取位置信息';
                switch(error.code) {
                    case error.PERMISSION_DENIED:
                        errorMessage = '用户拒绝了位置请求';
                        break;
                    case error.POSITION_UNAVAILABLE:
                        errorMessage = '位置信息不可用';
                        break;
                    case error.TIMEOUT:
                        errorMessage = '获取位置超时';
                        break;
                }
                
                statusDiv.innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i> ${errorMessage}
                        <br><small>将显示默认办公地址</small>
                    </div>
                `;
                
                // 显示默认办公地址
                initMap(OFFICE_LOCATION.lat, OFFICE_LOCATION.lng);
            },
            {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 60000
            }
        );
    } else {
        statusDiv.innerHTML = `
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle"></i> 浏览器不支持地理定位
                <br><small>将显示默认办公地址</small>
            </div>
        `;
        initMap(OFFICE_LOCATION.lat, OFFICE_LOCATION.lng);
    }
}

// 初始化地图
function initMap(userLat, userLng) {
    const mapDiv = document.getElementById('map');
    
    // 清除现有内容
    mapDiv.innerHTML = '';
    
    // 创建地图容器
    const mapContainer = document.createElement('div');
    mapContainer.style.width = '100%';
    mapContainer.style.height = '100%';
    mapContainer.style.position = 'relative';
    mapDiv.appendChild(mapContainer);
    
    // 使用高德地图静态图片API（无需密钥）
    const mapUrl = `https://restapi.amap.com/v3/staticmap?location=${userLng},${userLat}&zoom=15&size=400*300&markers=mid,red,A:${userLng},${userLat}&key=`;
    
    const img = document.createElement('img');
    img.src = mapUrl;
    img.style.width = '100%';
    img.style.height = '100%';
    img.style.objectFit = 'cover';
    img.style.borderRadius = '8px';
    
    // 如果图片加载失败，显示备用方案
    img.onerror = function() {
        mapContainer.innerHTML = `
            <div class="d-flex align-items-center justify-content-center h-100 bg-light" style="border-radius: 8px;">
                <div class="text-center">
                    <i class="fas fa-map-marker-alt fa-3x text-primary mb-3"></i>
                    <h6>位置信息</h6>
                    <p class="text-muted">纬度: ${userLat.toFixed(6)}</p>
                    <p class="text-muted">经度: ${userLng.toFixed(6)}</p>
                    <div class="d-grid gap-2">
                        <a href="https://www.amap.com/place/${userLng},${userLat}" target="_blank" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-external-link-alt"></i> 在高德地图中查看
                        </a>
                        <a href="https://maps.google.com/?q=${userLat},${userLng}" target="_blank" class="btn btn-sm btn-outline-success">
                            <i class="fas fa-external-link-alt"></i> 在Google地图中查看
                        </a>
                    </div>
                </div>
            </div>
        `;
    };
    
    // 添加点击事件，点击图片可以打开地图
    img.style.cursor = 'pointer';
    img.onclick = function() {
        window.open(`https://www.amap.com/place/${userLng},${userLat}`, '_blank');
    };
    
    // 添加提示文字
    const overlay = document.createElement('div');
    overlay.style.position = 'absolute';
    overlay.style.top = '10px';
    overlay.style.left = '10px';
    overlay.style.background = 'rgba(0,0,0,0.7)';
    overlay.style.color = 'white';
    overlay.style.padding = '5px 10px';
    overlay.style.borderRadius = '4px';
    overlay.style.fontSize = '12px';
    overlay.innerHTML = '点击查看详细地图';
    
    mapContainer.appendChild(img);
    mapContainer.appendChild(overlay);
}

// 计算两点间距离（使用Haversine公式）
function calculateDistance(lat1, lng1, lat2, lng2) {
    const R = 6371; // 地球半径（公里）
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLng = (lng2 - lng1) * Math.PI / 180;
    const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
              Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
              Math.sin(dLng/2) * Math.sin(dLng/2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
}

// 显示距离信息
function showDistanceInfo(distance, officeName) {
    const statusDiv = document.getElementById('location-status');
    const currentContent = statusDiv.innerHTML;
    
    statusDiv.innerHTML = currentContent + `
        <div class="alert alert-info mt-2">
            <i class="fas fa-route"></i> 距离${officeName}: ${distance.toFixed(1)} 公里
        </div>
    `;
}

// 切换办公地址
function changeOffice() {
    const select = document.getElementById('office-select');
    currentOfficeIndex = parseInt(select.value);
    const office = OFFICE_LOCATIONS[currentOfficeIndex];
    
    // 更新显示信息
    document.getElementById('office-address').textContent = office.address;
    document.getElementById('office-phone').textContent = office.phone;
    document.getElementById('office-email').textContent = office.email;
    document.getElementById('office-hours').textContent = office.workingHours;
    
    // 更新地图
    initMap(office.lat, office.lng);
    
    // 清除位置状态
    const statusDiv = document.getElementById('location-status');
    statusDiv.style.display = 'none';
}

// 在导航中打开
function openInMaps() {
    const office = OFFICE_LOCATIONS[currentOfficeIndex];
    const url = `https://uri.amap.com/navigation?to=${office.lng},${office.lat},${encodeURIComponent(office.address)}&mode=car&policy=1&src=mypage&coordinate=gaode&callnative=0`;
    window.open(url, '_blank');
}

// 页面加载时显示默认位置
document.addEventListener('DOMContentLoaded', function() {
    // 延迟加载，避免影响页面性能
    setTimeout(() => {
        const office = OFFICE_LOCATIONS[currentOfficeIndex];
        initMap(office.lat, office.lng);
    }, 1000);
});
</script>
{% endblock %} 