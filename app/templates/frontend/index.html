{% extends "base.html" %}

{% block title %}首页 - Kim's Blog{% endblock %}

{% block content %}
<!-- 英雄区域 -->
<div class="text-center py-16 mb-12">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-5xl md:text-6xl font-bold mb-6 bg-gradient-to-r from-indigo-400 to-purple-500 bg-clip-text text-transparent">
            Welcome
        </h1>
        <p class="text-xl text-slate-300 mb-8">Hi! 欢迎光临我的小站，这是我分享技术与思考的社区</p>
        
        <!-- 首页搜索区域 -->
        <div class="max-w-md mx-auto">
            <form method="GET" action="{{ url_for('main.search') }}" class="relative">
                <input type="text" name="q" placeholder="搜索文章、项目、技术内容..." 
                       value="{{ request.args.get('q', '') }}"
                       class="w-full bg-slate-800/50 border border-slate-700 rounded-full py-3 px-6 pl-12 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                <i class="fas fa-search absolute left-4 top-4 text-slate-400"></i>
            </form>
        </div>
    </div>
</div>

<!-- 特色内容 -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
    <div class="glass-card rounded-xl p-8 text-center hover:transform hover:scale-105 transition-all duration-300">
        <div class="w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-code text-2xl text-white"></i>
        </div>
        <h3 class="text-xl font-bold mb-3 text-white">项目展示</h3>
        <p class="text-slate-300 mb-6">查看我开发的各种项目，包括Web应用、移动应用和其他技术作品。</p>
        <a href="{{ url_for('main.projects') }}" class="btn-primary text-white px-6 py-2 rounded-full text-sm font-medium inline-flex items-center">
            浏览项目 <i class="fas fa-arrow-right ml-2"></i>
        </a>
    </div>
    
    <div class="glass-card rounded-xl p-8 text-center hover:transform hover:scale-105 transition-all duration-300">
        <div class="w-16 h-16 bg-purple-600 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-blog text-2xl text-white"></i>
        </div>
        <h3 class="text-xl font-bold mb-3 text-white">技术博客</h3>
        <p class="text-slate-300 mb-6">分享我的技术心得、学习笔记和行业见解。</p>
        <a href="{{ url_for('main.blog') }}" class="btn-primary text-white px-6 py-2 rounded-full text-sm font-medium inline-flex items-center">
            阅读博客 <i class="fas fa-arrow-right ml-2"></i>
        </a>
    </div>
    
    <div class="glass-card rounded-xl p-8 text-center hover:transform hover:scale-105 transition-all duration-300">
        <div class="w-16 h-16 bg-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-user text-2xl text-white"></i>
        </div>
        <h3 class="text-xl font-bold mb-3 text-white">关于我</h3>
        <p class="text-slate-300 mb-6">了解我的技术背景、工作经历和个人兴趣。</p>
        <a href="{{ url_for('main.about') }}" class="btn-primary text-white px-6 py-2 rounded-full text-sm font-medium inline-flex items-center">
            了解更多 <i class="fas fa-arrow-right ml-2"></i>
        </a>
    </div>
</div>

<!-- 最新文章 -->
{% if recent_posts %}
<div class="mb-12">
    <div class="flex items-center justify-between mb-8">
        <h2 class="text-3xl font-bold text-indigo-300">最新文章</h2>
        <a href="{{ url_for('main.blog') }}" class="text-indigo-300 hover:text-indigo-200 flex items-center">
            查看全部 <i class="fas fa-arrow-right ml-2"></i>
        </a>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for post in recent_posts[:3] %}
        <article class="glass-card rounded-xl p-6 hover:transform hover:scale-105 transition-all duration-300">
            <div class="flex items-center justify-between mb-3">
                <span class="text-sm text-indigo-300">{{ post.category or '未分类' }}</span>
                <span class="text-sm text-slate-400">{{ post.created_at.strftime('%m-%d') }}</span>
            </div>
            
            <h3 class="text-lg font-bold mb-3 text-white hover:text-indigo-300 transition-colors">
                <a href="{{ url_for('main.post_detail', slug=post.safe_slug) }}">{{ post.title }}</a>
            </h3>
            
            <p class="text-slate-300 text-sm mb-4 line-clamp-3">{{ (post.excerpt or post.content[:100] + '...' if post.content|length > 100 else post.content)|striptags }}</p>
            
            <div class="flex items-center justify-between text-sm text-slate-400">
                <div class="flex items-center space-x-3">
                    <span><i class="fas fa-eye mr-1"></i>{{ post.view_count }}</span>
                    <span><i class="far fa-heart mr-1"></i>{{ post.like_count }}</span>
                </div>
                <a href="{{ url_for('main.post_detail', slug=post.safe_slug) }}" class="text-indigo-300 hover:text-indigo-200">
                    阅读更多 <i class="fas fa-arrow-right ml-1"></i>
                </a>
            </div>
        </article>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- 最新项目 -->
{% if recent_projects %}
<div class="mb-12">
    <div class="flex items-center justify-between mb-8">
        <h2 class="text-3xl font-bold text-indigo-300">最新项目</h2>
        <a href="{{ url_for('main.projects') }}" class="text-indigo-300 hover:text-indigo-200 flex items-center">
            查看全部 <i class="fas fa-arrow-right ml-2"></i>
        </a>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for project in recent_projects[:3] %}
        <div class="glass-card rounded-xl overflow-hidden hover:transform hover:scale-105 transition-all duration-300">
            <a href="{{ url_for('main.project_detail', project_id=project.id) }}" class="block">
                {% if project.image_url %}
                <div class="h-40 overflow-hidden">
                    <img src="{{ project.image_url }}" alt="{{ project.title }}" class="w-full h-full object-cover">
                </div>
                {% else %}
                <div class="h-40 bg-slate-700 flex items-center justify-center">
                    <i class="fas fa-code fa-2x text-slate-400"></i>
                </div>
                {% endif %}
                
                <div class="p-6">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm text-indigo-300">{{ project.category or '未分类' }}</span>
                        <span class="text-sm text-slate-400">{{ project.created_at.strftime('%m-%d') }}</span>
                    </div>
                    
                    <h3 class="text-lg font-bold mb-2 text-white hover:text-indigo-300 transition-colors">{{ project.title }}</h3>
                    
                    <p class="text-slate-300 text-sm mb-4 line-clamp-2">{{ (project.short_description or project.description[:80] + '...' if project.description|length > 80 else project.description)|striptags }}</p>
                    
                    <div class="flex items-center justify-between text-sm text-slate-400">
                        <div class="flex items-center space-x-3">
                            <span><i class="fas fa-eye mr-1"></i>{{ project.view_count }}</span>
                            <span><i class="far fa-heart mr-1"></i>{{ project.like_count }}</span>
                        </div>
                        <span class="text-indigo-300">查看详情</span>
                    </div>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- 技能展示 -->
{% if skills %}
<div class="mb-12">
    <h2 class="text-3xl font-bold text-indigo-300 mb-8 text-center">技术栈</h2>
    
    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
        {% for skill in skills[:12] %}
        <div class="glass-card rounded-xl p-4 text-center hover:transform hover:scale-105 transition-all duration-300">
            <div class="w-12 h-12 mx-auto mb-2 flex items-center justify-center">
                {% if skill.icon %}
                    {% if skill.icon.startswith('http') %}
                        <img src="{{ skill.icon }}" alt="{{ skill.name }}" class="w-8 h-8 object-contain">
                    {% else %}
                        <i class="{{ skill.icon }} text-2xl text-indigo-300"></i>
                    {% endif %}
                {% else %}
                    <i class="fas fa-code text-2xl text-indigo-300"></i>
                {% endif %}
            </div>
            <h4 class="text-sm font-medium text-white">{{ skill.name }}</h4>
            {% if skill.proficiency %}
            <div class="mt-2">
                <div class="w-full bg-slate-700 rounded-full h-1">
                    <div class="bg-indigo-500 h-1 rounded-full" style="width: {{ skill.proficiency }}%"></div>
                </div>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- 版本更新 -->

<!-- 版本更新记录 -->
{% if versions %}
<div class="mb-12">
    <div class="flex items-center justify-between mb-8">
        <h2 class="text-3xl font-bold text-indigo-300">版本更新记录</h2>
    </div>
    
    <div class="relative">
        <!-- 滚动容器 -->
        <div class="version-scroll-container overflow-x-auto scrollbar-hide" id="versionScrollContainer">
            <div class="flex gap-6 pb-4" style="width: max-content;">
                {% for version in versions %}
                <div class="version-card flex-shrink-0">
                    <!-- 悬浮提示 -->
                    <div class="version-tooltip">
                        <div class="font-semibold mb-2">{{ version.title }}</div>
                        <div>{{ version.description }}</div>
                    </div>
                    <div class="glass-card rounded-xl p-6 hover:transform hover:scale-105 transition-all duration-300 min-w-[300px]">
                        <!-- 版本头部 -->
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <div class="version-icon {% if '初始' in version.title or 'v1.0' in version.version_number %}icon-rocket{% elif '交互' in version.title or '评论' in version.title %}icon-comments{% elif '回复' in version.title %}icon-reply{% elif '版本' in version.title or '管理' in version.title %}icon-cog{% elif 'UI' in version.title or '界面' in version.title %}icon-palette{% elif '功能' in version.title %}icon-star{% else %}icon-default{% endif %}">
                                    {% if '初始' in version.title or 'v1.0' in version.version_number %}
                                        <i class="fas fa-rocket"></i>
                                    {% elif '交互' in version.title or '评论' in version.title %}
                                        <i class="fas fa-comments"></i>
                                    {% elif '回复' in version.title %}
                                        <i class="fas fa-reply"></i>
                                    {% elif '版本' in version.title or '管理' in version.title %}
                                        <i class="fas fa-cog"></i>
                                    {% elif 'UI' in version.title or '界面' in version.title %}
                                        <i class="fas fa-palette"></i>
                                    {% elif '功能' in version.title %}
                                        <i class="fas fa-star"></i>
                                    {% else %}
                                        <i class="fas fa-code-branch"></i>
                                    {% endif %}
                                </div>
                                <div>
                                    <div class="version-number {% if '初始' in version.title or 'v1.0' in version.version_number %}badge-rocket{% elif '交互' in version.title or '评论' in version.title %}badge-comments{% elif '回复' in version.title %}badge-reply{% elif '版本' in version.title or '管理' in version.title %}badge-cog{% elif 'UI' in version.title or '界面' in version.title %}badge-palette{% elif '功能' in version.title %}badge-star{% else %}badge-default{% endif %}">
                                        {{ version.version_number }}
                                    </div>
                                </div>
                            </div>
                            <div class="version-date text-slate-400 text-sm">
                                {{ version.release_date.strftime('%Y.%m') if version.release_date else '未知' }}
                            </div>
                        </div>
                        
                        <!-- 版本内容 -->
                        <div class="version-content">
                            <h3 class="text-lg font-semibold text-white mb-2 version-title" title="{{ version.title }}">{{ version.title }}</h3>
                            <div class="version-description" title="{{ version.description }}">
                                {{ version.description|nl2br|safe }}
                            </div>
                        </div>
                        
                        <!-- 版本标签 -->
                        <div class="flex items-center gap-2 mt-4">
                            {% if '初始' in version.title or 'v1.0' in version.version_number %}
                                <span class="px-2 py-1 bg-orange-600/20 text-orange-400 rounded text-xs">里程碑</span>
                            {% elif '交互' in version.title or '评论' in version.title %}
                                <span class="px-2 py-1 bg-blue-600/20 text-blue-400 rounded text-xs">交互功能</span>
                            {% elif '回复' in version.title %}
                                <span class="px-2 py-1 bg-green-600/20 text-green-400 rounded text-xs">回复系统</span>
                            {% elif '版本' in version.title or '管理' in version.title %}
                                <span class="px-2 py-1 bg-purple-600/20 text-purple-400 rounded text-xs">系统管理</span>
                            {% elif 'UI' in version.title or '界面' in version.title %}
                                <span class="px-2 py-1 bg-pink-600/20 text-pink-400 rounded text-xs">界面优化</span>
                            {% elif '功能' in version.title %}
                                <span class="px-2 py-1 bg-yellow-600/20 text-yellow-400 rounded text-xs">新功能</span>
                            {% else %}
                                <span class="px-2 py-1 bg-slate-600/20 text-slate-400 rounded text-xs">更新</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <!-- 滚动控制按钮 -->
        <div class="version-controls">
            <button class="version-btn version-prev" onclick="scrollVersion(-1)" id="versionPrevBtn">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button class="version-btn version-next" onclick="scrollVersion(1)" id="versionNextBtn">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>
</div>
{% endif %}

<style>
/* 版本更新记录样式 */
.version-scroll-container {
    scrollbar-width: none;
    -ms-overflow-style: none;
}

.version-scroll-container::-webkit-scrollbar {
    display: none;
}

.version-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    color: white;
}

.version-icon.icon-rocket {
    background: linear-gradient(135deg, #f97316, #ea580c);
}

.version-icon.icon-comments {
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
}

.version-icon.icon-reply {
    background: linear-gradient(135deg, #10b981, #059669);
}

.version-icon.icon-cog {
    background: linear-gradient(135deg, #8b5cf6, #7c3aed);
}

.version-icon.icon-palette {
    background: linear-gradient(135deg, #ec4899, #db2777);
}

.version-icon.icon-star {
    background: linear-gradient(135deg, #eab308, #ca8a04);
}

.version-icon.icon-default {
    background: linear-gradient(135deg, #64748b, #475569);
}

.version-number {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    color: white;
}

.version-number.badge-rocket {
    background: linear-gradient(135deg, #f97316, #ea580c);
}

.version-number.badge-comments {
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
}

.version-number.badge-reply {
    background: linear-gradient(135deg, #10b981, #059669);
}

.version-number.badge-cog {
    background: linear-gradient(135deg, #8b5cf6, #7c3aed);
}

.version-number.badge-palette {
    background: linear-gradient(135deg, #ec4899, #db2777);
}

.version-number.badge-star {
    background: linear-gradient(135deg, #eab308, #ca8a04);
}

.version-number.badge-default {
    background: linear-gradient(135deg, #64748b, #475569);
}

.version-controls {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 100%;
    display: flex;
    justify-content: space-between;
    pointer-events: none;
}

.version-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(30, 41, 59, 0.8);
    border: 1px solid rgba(71, 85, 105, 0.3);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    pointer-events: auto;
    backdrop-filter: blur(10px);
}

.version-btn:hover {
    background: rgba(30, 41, 59, 1);
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.version-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
    transform: none;
}

.version-prev {
    left: -20px;
}

.version-next {
    right: -20px;
}

/* 版本内容样式 */
.version-content {
    height: 120px; /* 固定高度 */
    display: flex;
    flex-direction: column;
}

.version-title {
    height: 24px; /* 标题固定高度 */
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    line-height: 24px;
}

.version-description {
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 4; /* 最多显示4行 */
    -webkit-box-orient: vertical;
    line-height: 1.4;
    color: #cbd5e1;
    font-size: 14px;
    word-break: break-word;
}

/* 悬浮提示样式 */
.version-card {
    position: relative;
}

.version-card .version-tooltip {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(15, 23, 42, 0.95);
    color: white;
    padding: 12px 16px;
    border-radius: 8px;
    font-size: 14px;
    line-height: 1.5;
    white-space: pre-wrap;
    max-width: 300px;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    border: 1px solid rgba(71, 85, 105, 0.3);
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.version-card .version-tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 6px solid transparent;
    border-top-color: rgba(15, 23, 42, 0.95);
}

.version-card:hover .version-tooltip {
    opacity: 1;
    visibility: visible;
}

/* 响应式设计 */
@media (max-width: 768px) {
    .version-controls {
        display: none;
    }
    
    .version-card .glass-card {
        min-width: 280px;
    }
}
</style>

<script>
// 版本滚动功能
function scrollVersion(direction) {
    const container = document.getElementById('versionScrollContainer');
    if (!container) return;

    const scrollAmount = 320; // 每次滚动的距离（卡片宽度 + 间距）
    const currentScroll = container.scrollLeft;
    const newScroll = currentScroll + (direction * scrollAmount);

    container.scrollTo({
        left: newScroll,
        behavior: 'smooth'
    });
}

// 更新滚动按钮状态
function updateScrollButtons() {
    const container = document.getElementById('versionScrollContainer');
    const prevBtn = document.getElementById('versionPrevBtn');
    const nextBtn = document.getElementById('versionNextBtn');
    
    if (!container || !prevBtn || !nextBtn) return;

    const isAtStart = container.scrollLeft <= 0;
    const isAtEnd = container.scrollLeft >= (container.scrollWidth - container.clientWidth);

    prevBtn.disabled = isAtStart;
    nextBtn.disabled = isAtEnd;
}

// 触摸滑动支持
document.addEventListener('DOMContentLoaded', function() {
    const container = document.getElementById('versionScrollContainer');
    if (!container) return;

    // 初始化按钮状态
    updateScrollButtons();

    // 监听滚动事件
    container.addEventListener('scroll', updateScrollButtons);

    let isDown = false;
    let startX;
    let scrollLeft;

    container.addEventListener('mousedown', (e) => {
        isDown = true;
        container.classList.add('active');
        startX = e.pageX - container.offsetLeft;
        scrollLeft = container.scrollLeft;
    });

    container.addEventListener('mouseleave', () => {
        isDown = false;
        container.classList.remove('active');
    });

    container.addEventListener('mouseup', () => {
        isDown = false;
        container.classList.remove('active');
    });

    container.addEventListener('mousemove', (e) => {
        if (!isDown) return;
        e.preventDefault();
        const x = e.pageX - container.offsetLeft;
        const walk = (x - startX) * 2;
        container.scrollLeft = scrollLeft - walk;
    });

    // 触摸事件支持
    let touchStartX = 0;
    let touchStartY = 0;

    container.addEventListener('touchstart', (e) => {
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
    });

    container.addEventListener('touchmove', (e) => {
        if (!touchStartX || !touchStartY) return;

        const touchCurrentX = e.touches[0].clientX;
        const touchCurrentY = e.touches[0].clientY;

        const diffX = touchStartX - touchCurrentX;
        const diffY = touchStartY - touchCurrentY;

        // 如果是水平滑动
        if (Math.abs(diffX) > Math.abs(diffY)) {
            e.preventDefault();
            container.scrollLeft += diffX;
            touchStartX = touchCurrentX;
        }
    });

    container.addEventListener('touchend', () => {
        touchStartX = 0;
        touchStartY = 0;
    });
});
</script>

{% endblock %}